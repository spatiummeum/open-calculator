{"version":3,"names":["productsToDiscount","invoiceTotalInput","document","getElementById","productValueInput","isHalfCheckbox","addProductBtn","calculateBtn","productsList","resultsCard","clearAllBtn","formatCurrency","amount","Intl","NumberFormat","style","currency","minimumFractionDigits","maximumFractionDigits","format","errorAlertElement","errorMessageElement","showError","message","textContent","display","hideError","renderProductsList","firstChild","removeChild","length","emptyState","createElement","className","appendChild","forEach","product","idx","div","productInfo","p","strong","baseValue","isHalf","value","createTextNode","small","button","dataset","title","icon","querySelectorAll","btn","addEventListener","e","parseInt","getAttribute","isNaN","splice","parseFloat","checked","toString","split","push","focus","originalInvoiceTotal","totalDiscountAmount","IVA_RATE","baseValueToDiscount","valueWithIva","newInvoiceTotal"],"sources":["main.js"],"sourcesContent":["\n// =========================\n// VARIABLES Y ELEMENTOS DEL DOM\n// =========================\n// Array para almacenar los productos a descontar\n// Cada producto es un objeto: { value: número, isHalf: booleano }\nlet productsToDiscount = [];\nconst invoiceTotalInput = document.getElementById('invoice-total');\nconst productValueInput = document.getElementById('product-value');\nconst isHalfCheckbox = document.getElementById('is-half');\nconst addProductBtn = document.getElementById('add-product-btn');\nconst calculateBtn = document.getElementById('calculate-btn');\nconst productsList = document.getElementById('products-list');\nconst resultsCard = document.getElementById('results-card');\nconst clearAllBtn = document.getElementById('clear-all-btn');\n\n// =========================\n// UTILIDAD: Formatear moneda CLP\n// =========================\n// Formatea un número como moneda chilena (pesos) con 2 decimales\n// Ejemplo: 10000.50 -> \"$10.000,50\"\nconst formatCurrency = (amount) => {\n    return new Intl.NumberFormat('es-CL', { \n        style: 'currency', \n        currency: 'CLP',\n        minimumFractionDigits: 2,\n        maximumFractionDigits: 2\n    }).format(amount);\n};\n\n// =========================\n// MANEJO DE ERRORES\n// =========================\n// Referencias a elementos DOM para mostrar mensajes de error\nconst errorAlertElement = document.getElementById('error-alert');\nconst errorMessageElement = document.getElementById('error-message');\n\n// Muestra un mensaje de error en la interfaz\n// @param {string} message - Mensaje de error a mostrar\nconst showError = (message) => {\n    errorMessageElement.textContent = message;\n    errorAlertElement.style.display = 'block';\n};\n\n// Oculta el mensaje de error\nconst hideError = () => {\n    errorAlertElement.style.display = 'none';\n};\n\n// =========================\n// RENDERIZAR LISTA DE PRODUCTOS\n// =========================\n// Actualiza la interfaz mostrando la lista de productos agregados\n// Si no hay productos, muestra un estado vacío\nfunction renderProductsList() {\n    // Limpiar lista de manera segura\n    while (productsList.firstChild) {\n        productsList.removeChild(productsList.firstChild);\n    }\n    \n    if (productsToDiscount.length === 0) {\n        const emptyState = document.createElement('p');\n        emptyState.className = 'empty-state';\n        emptyState.textContent = 'No hay productos agregados';\n        productsList.appendChild(emptyState);\n        calculateBtn.style.display = 'none';\n        clearAllBtn.style.display = 'none';\n        return;\n    }\n    \n    productsToDiscount.forEach((product, idx) => {\n        const div = document.createElement('div');\n        div.className = 'product-item';\n        \n        const productInfo = document.createElement('div');\n        productInfo.className = 'product-info';\n        \n        const p = document.createElement('p');\n        const strong = document.createElement('strong');\n        // Usar valor float directamente\n        const baseValue = product.isHalf ? product.value / 2 : product.value;\n        strong.textContent = formatCurrency(baseValue);\n        \n        p.appendChild(document.createTextNode('Producto con valor base de '));\n        p.appendChild(strong);\n        \n        const small = document.createElement('small');\n        small.textContent = `Unidades: ${product.isHalf ? 'Sí' : 'No'}`;\n        \n        productInfo.appendChild(p);\n        productInfo.appendChild(small);\n        \n        const button = document.createElement('button');\n        button.className = 'btn btn-outline btn-small';\n        button.dataset.idx = idx;\n        button.title = 'Eliminar';\n        \n        // Crear ícono de eliminación de manera segura\n        const icon = document.createElement('span');\n        icon.textContent = '✕'; // Uso de entidad segura\n        button.appendChild(icon);\n        \n        div.appendChild(productInfo);\n        div.appendChild(button);\n        productsList.appendChild(div);\n    });\n    \n    calculateBtn.style.display = 'block';\n    clearAllBtn.style.display = 'block';\n    \n    // Asignar eventos a los botones de eliminar\n    productsList.querySelectorAll('button[data-idx]').forEach(btn => {\n        btn.addEventListener('click', (e) => {\n            const idx = parseInt(btn.getAttribute('data-idx'));\n            if (!isNaN(idx) && idx >= 0 && idx < productsToDiscount.length) {\n                productsToDiscount.splice(idx, 1);\n                renderProductsList();\n                resultsCard.style.display = 'none';\n            }\n        });\n    });\n}\n\n// =========================\n// EVENTO: Agregar producto\n// =========================\n// Maneja el clic en el botón \"Agregar producto\":\n// 1. Valida que el valor ingresado sea válido (>0)\n// 2. Agrega el producto al array productsToDiscount\n// 3. Actualiza la lista de productos\n// 4. Limpia los campos de entrada\naddProductBtn.addEventListener('click', () => {\n    const value = parseFloat(productValueInput.value);\n    const isHalf = isHalfCheckbox.checked;\n\n    // Validación mejorada - valores numéricos y límites\n    if (isNaN(value) || value <= 0 || value > 1000000000) {\n        showError('Por favor, ingrese un valor de producto válido entre 1 y 1.000.000.000.');\n        return;\n    }\n    \n    // Validar que el valor no contenga más de 2 decimales\n    if ((value.toString().split('.')[1] || []).length > 2) {\n        showError('Por favor, ingrese un valor con máximo 2 decimales.');\n        return;\n    }\n\n    // Guardamos el producto en nuestro array\n    productsToDiscount.push({ value, isHalf });\n    renderProductsList();\n    // Limpiamos los inputs y ocultamos errores\n    productValueInput.value = '';\n    isHalfCheckbox.checked = false;\n    productValueInput.focus();\n    hideError();\n});\n\n// =========================\n// EVENTO: Limpiar todo\n// =========================\n// Resetea toda la aplicación:\n// 1. Vacía la lista de productos\n// 2. Limpia todos los campos de entrada\n// 3. Oculta los resultados\nclearAllBtn.addEventListener('click', () => {\n    productsToDiscount.length = 0;\n    renderProductsList();\n    resultsCard.style.display = 'none';\n    productValueInput.value = '';\n    isHalfCheckbox.checked = false;\n    invoiceTotalInput.value = '';\n});\n\n// =========================\n// EVENTO: Calcular descuento final\n// =========================\n// Realiza el cálculo completo de descuentos:\n// 1. Valida el monto total de la factura\n// 2. Calcula el descuento para cada producto (considerando IVA)\n// 3. Actualiza la interfaz con los resultados\ncalculateBtn.addEventListener('click', () => {\n    const originalInvoiceTotal = parseFloat(invoiceTotalInput.value);\n\n    // Validación mejorada para el total de la factura\n    if (isNaN(originalInvoiceTotal) || originalInvoiceTotal <= 0 || originalInvoiceTotal > 10000000000) {\n        showError('Por favor, ingrese un monto de factura válido entre 1 y 10.000.000.000.');\n        return;\n    }\n    \n    // Validar decimales\n    if ((originalInvoiceTotal.toString().split('.')[1] || []).length > 2) {\n        showError('El monto de la factura debe tener máximo 2 decimales.');\n        return;\n    }\n\n    if (productsToDiscount.length === 0) {\n        showError('Por favor, añada al menos un producto para descontar.');\n        return;\n    }\n    \n    hideError();\n\n    let totalDiscountAmount = 0;\n    const IVA_RATE = 0.19; // Tasa de IVA (19%)\n\n    // Cálculo de descuento manteniendo precisión float\n    productsToDiscount.forEach(product => {\n        // 1. Determinar valor base: completo o mitad (para unidades)\n        let baseValueToDiscount = product.isHalf ? product.value / 2 : product.value;\n        \n        // 2. Calcular valor con IVA: base * (1 + IVA_RATE)\n        let valueWithIva = baseValueToDiscount * (1 + IVA_RATE);\n        \n        // 3. Acumular al descuento total manteniendo float\n        totalDiscountAmount += valueWithIva;\n    });\n\n    // 4. Calcular el nuevo total con float\n    const newInvoiceTotal = originalInvoiceTotal - totalDiscountAmount;\n\n    // Mostramos los resultados\n    document.getElementById('result-original').textContent = formatCurrency(originalInvoiceTotal);\n    document.getElementById('result-discount').textContent = formatCurrency(totalDiscountAmount);\n    document.getElementById('result-total').textContent = formatCurrency(newInvoiceTotal);\n    \n    resultsCard.style.display = 'block';\n});\n"],"mappings":"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","ignoreList":[]}